<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='http://localhost:1313/js/theme-mode.js'></script>
    <link rel="stylesheet" href='http://localhost:1313/css/frameworks.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/github.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/github-style.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/light.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/dark.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/syntax.css' />
    <title>Unity XR 像 Alyx 一样抓取物体 - Chneixn Blog</title>
    
    <link rel="icon" type="image/x-icon" href='http://localhost:1313/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    

    
    <meta name="description"
  content="像 Alyx 一样抓取物体 Source Video: https://www.youtube.com/watch?v=WU23Uj1oeh8
基于 Unity XR Interaction Toolkit 2.6.3
Ray Interactor 在 Interaction Layer Mask 设置好交互层级为 Interactable Default
Anchor Control 选项可选
Grablale Object 可以抓取的物体需要有 mesh collider 组件
注意 Interaction Layer Mask 以及 Movement Type 的设置
XR Alyx Grab Interactable 该脚本继承于 XRGrabInteractable
功能简介：
对准可抓取的物体时显示射线，物体会显示描边（可选显示一层覆盖颜色） 按住抓取按键时选中物体 选中物体后将手柄向上提起，物体会向手部位置飞去 ❗飞来的物体需要再次按抓取键才能抓在手上
using System.Collections; using System.Collections.Generic; using UnityEngine; using UnityEngine.XR.Interaction.Toolkit; public class XRAlyxGrabInteractable : XRGrabInteractable { [Tooltip(&#34;跳跃的速度阈值&#34;)] public float velocityThreshold = 2f; [Tooltip(&#34;跳跃时的角度&#34;)] public float jumpAngleInDegree = 60f; private XRRayInteractor rayInteractor; private Vector3 previousPos; private Rigidbody rb; private bool canJump = true; protected override void Awake() { base.Awake(); rb = GetComponent&lt;Rigidbody&gt;(); } private void Update() { if (isSelected &amp;&amp; canJump &amp;&amp; firstInteractorSelecting is XRRayInteractor) { // 当物体被抓住时，计算速度是否超过阈值，超过则执行跳跃 Vector3 velocity = (rayInteractor.transform.position - previousPos) / Time.deltaTime; previousPos = rayInteractor.transform.position; if (velocity.magnitude &gt; velocityThreshold) { // 脱离抓取 Drop(); // 计算跳跃初速度 rb.velocity = ComputeVelocity(transform.position, rayInteractor.transform.position, jumpAngleInDegree, Physics.gravity.y); canJump = false; } } } /// &lt;summary&gt; /// 基于重力计算弹道轨迹，计算从自身跳跃到指定地点的跳跃速度 /// &lt;/summary&gt; /// &lt;param name=&#34;selfPos&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;targetPos&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;jumpAngle&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;gravity&#34;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public static Vector3 ComputeVelocity(Vector3 selfPos, Vector3 targetPos, float jumpAngle, float gravity) { Vector3 diff = targetPos - selfPos; Vector3 diffXZ = new(diff.x, 0, diff.z); float diffXZLength = diffXZ.magnitude; float diffYLength = diff.y; float angleInRadian = Mathf.Clamp(diff.normalized.y * 90, jumpAngle, 90) * Mathf.Deg2Rad; float jumpSpeed = Mathf.Sqrt(-gravity * Mathf.Pow(diffXZLength, 2) / (2 * Mathf.Cos(angleInRadian) * Mathf.Cos(angleInRadian) * (diffXZ.magnitude * Mathf.Tan(angleInRadian) - diffYLength))); Vector3 jumpVelocityVector = jumpSpeed * Mathf.Cos(angleInRadian) * diffXZ.normalized &#43; jumpSpeed * Mathf.Sin(angleInRadian) * Vector3.up; return jumpVelocityVector; } protected override void OnSelectEntered(SelectEnterEventArgs args) { // 控制器检测 只响应射线交互器 if (args.interactableObject is XRRayInteractor) { trackPosition = false; trackRotation = false; throwOnDetach = false; rayInteractor = (XRRayInteractor)args.interactorObject; previousPos = rayInteractor.transform.position; canJump = true; } else { trackPosition = true; trackRotation = true; throwOnDetach = true; } base.OnSelectEntered(args); } } " />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="http://localhost:1313/post/%E5%83%8Falyx%E4%B8%80%E6%A0%B7%E6%8A%93%E5%8F%96%E7%89%A9%E4%BD%93/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Unity XR 像 Alyx 一样抓取物体 - Chneixn Blog" />
<meta name="twitter:description"
  content="像 Alyx 一样抓取物体 Source Video: https://www.youtube.com/watch?v=WU23Uj1oeh8
基于 Unity XR Interaction Toolkit 2.6.3
Ray Interactor 在 Interaction Layer Mask 设置好交互层级为 Interactable Default
Anchor Control 选项可选
Grablale Object 可以抓取的物体需要有 mesh collider 组件
注意 Interaction Layer Mask 以及 Movement Type 的设置
XR Alyx Grab Interactable 该脚本继承于 XRGrabInteractable
功能简介：
对准可抓取的物体时显示射线，物体会显示描边（可选显示一层覆盖颜色） 按住抓取按键时选中物体 选中物体后将手柄向上提起，物体会向手部位置飞去 ❗飞来的物体需要再次按抓取键才能抓在手上
using System.Collections; using System.Collections.Generic; using UnityEngine; using UnityEngine.XR.Interaction.Toolkit; public class XRAlyxGrabInteractable : XRGrabInteractable { [Tooltip(&#34;跳跃的速度阈值&#34;)] public float velocityThreshold = 2f; [Tooltip(&#34;跳跃时的角度&#34;)] public float jumpAngleInDegree = 60f; private XRRayInteractor rayInteractor; private Vector3 previousPos; private Rigidbody rb; private bool canJump = true; protected override void Awake() { base.Awake(); rb = GetComponent&lt;Rigidbody&gt;(); } private void Update() { if (isSelected &amp;&amp; canJump &amp;&amp; firstInteractorSelecting is XRRayInteractor) { // 当物体被抓住时，计算速度是否超过阈值，超过则执行跳跃 Vector3 velocity = (rayInteractor.transform.position - previousPos) / Time.deltaTime; previousPos = rayInteractor.transform.position; if (velocity.magnitude &gt; velocityThreshold) { // 脱离抓取 Drop(); // 计算跳跃初速度 rb.velocity = ComputeVelocity(transform.position, rayInteractor.transform.position, jumpAngleInDegree, Physics.gravity.y); canJump = false; } } } /// &lt;summary&gt; /// 基于重力计算弹道轨迹，计算从自身跳跃到指定地点的跳跃速度 /// &lt;/summary&gt; /// &lt;param name=&#34;selfPos&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;targetPos&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;jumpAngle&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;gravity&#34;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public static Vector3 ComputeVelocity(Vector3 selfPos, Vector3 targetPos, float jumpAngle, float gravity) { Vector3 diff = targetPos - selfPos; Vector3 diffXZ = new(diff.x, 0, diff.z); float diffXZLength = diffXZ.magnitude; float diffYLength = diff.y; float angleInRadian = Mathf.Clamp(diff.normalized.y * 90, jumpAngle, 90) * Mathf.Deg2Rad; float jumpSpeed = Mathf.Sqrt(-gravity * Mathf.Pow(diffXZLength, 2) / (2 * Mathf.Cos(angleInRadian) * Mathf.Cos(angleInRadian) * (diffXZ.magnitude * Mathf.Tan(angleInRadian) - diffYLength))); Vector3 jumpVelocityVector = jumpSpeed * Mathf.Cos(angleInRadian) * diffXZ.normalized &#43; jumpSpeed * Mathf.Sin(angleInRadian) * Vector3.up; return jumpVelocityVector; } protected override void OnSelectEntered(SelectEnterEventArgs args) { // 控制器检测 只响应射线交互器 if (args.interactableObject is XRRayInteractor) { trackPosition = false; trackRotation = false; throwOnDetach = false; rayInteractor = (XRRayInteractor)args.interactorObject; previousPos = rayInteractor.transform.position; canJump = true; } else { trackPosition = true; trackRotation = true; throwOnDetach = true; } base.OnSelectEntered(args); } } " />
<meta name="twitter:site" content="http://localhost:1313/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="http://localhost:1313/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Unity XR 像 Alyx 一样抓取物体 - Chneixn Blog">
<meta property="og:description"
  content="像 Alyx 一样抓取物体 Source Video: https://www.youtube.com/watch?v=WU23Uj1oeh8
基于 Unity XR Interaction Toolkit 2.6.3
Ray Interactor 在 Interaction Layer Mask 设置好交互层级为 Interactable Default
Anchor Control 选项可选
Grablale Object 可以抓取的物体需要有 mesh collider 组件
注意 Interaction Layer Mask 以及 Movement Type 的设置
XR Alyx Grab Interactable 该脚本继承于 XRGrabInteractable
功能简介：
对准可抓取的物体时显示射线，物体会显示描边（可选显示一层覆盖颜色） 按住抓取按键时选中物体 选中物体后将手柄向上提起，物体会向手部位置飞去 ❗飞来的物体需要再次按抓取键才能抓在手上
using System.Collections; using System.Collections.Generic; using UnityEngine; using UnityEngine.XR.Interaction.Toolkit; public class XRAlyxGrabInteractable : XRGrabInteractable { [Tooltip(&#34;跳跃的速度阈值&#34;)] public float velocityThreshold = 2f; [Tooltip(&#34;跳跃时的角度&#34;)] public float jumpAngleInDegree = 60f; private XRRayInteractor rayInteractor; private Vector3 previousPos; private Rigidbody rb; private bool canJump = true; protected override void Awake() { base.Awake(); rb = GetComponent&lt;Rigidbody&gt;(); } private void Update() { if (isSelected &amp;&amp; canJump &amp;&amp; firstInteractorSelecting is XRRayInteractor) { // 当物体被抓住时，计算速度是否超过阈值，超过则执行跳跃 Vector3 velocity = (rayInteractor.transform.position - previousPos) / Time.deltaTime; previousPos = rayInteractor.transform.position; if (velocity.magnitude &gt; velocityThreshold) { // 脱离抓取 Drop(); // 计算跳跃初速度 rb.velocity = ComputeVelocity(transform.position, rayInteractor.transform.position, jumpAngleInDegree, Physics.gravity.y); canJump = false; } } } /// &lt;summary&gt; /// 基于重力计算弹道轨迹，计算从自身跳跃到指定地点的跳跃速度 /// &lt;/summary&gt; /// &lt;param name=&#34;selfPos&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;targetPos&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;jumpAngle&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;gravity&#34;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public static Vector3 ComputeVelocity(Vector3 selfPos, Vector3 targetPos, float jumpAngle, float gravity) { Vector3 diff = targetPos - selfPos; Vector3 diffXZ = new(diff.x, 0, diff.z); float diffXZLength = diffXZ.magnitude; float diffYLength = diff.y; float angleInRadian = Mathf.Clamp(diff.normalized.y * 90, jumpAngle, 90) * Mathf.Deg2Rad; float jumpSpeed = Mathf.Sqrt(-gravity * Mathf.Pow(diffXZLength, 2) / (2 * Mathf.Cos(angleInRadian) * Mathf.Cos(angleInRadian) * (diffXZ.magnitude * Mathf.Tan(angleInRadian) - diffYLength))); Vector3 jumpVelocityVector = jumpSpeed * Mathf.Cos(angleInRadian) * diffXZ.normalized &#43; jumpSpeed * Mathf.Sin(angleInRadian) * Vector3.up; return jumpVelocityVector; } protected override void OnSelectEntered(SelectEnterEventArgs args) { // 控制器检测 只响应射线交互器 if (args.interactableObject is XRRayInteractor) { trackPosition = false; trackRotation = false; throwOnDetach = false; rayInteractor = (XRRayInteractor)args.interactorObject; previousPos = rayInteractor.transform.position; canJump = true; } else { trackPosition = true; trackRotation = true; throwOnDetach = true; } base.OnSelectEntered(args); } } " />
<meta property="og:url" content="http://localhost:1313/post/%E5%83%8Falyx%E4%B8%80%E6%A0%B7%E6%8A%93%E5%8F%96%E7%89%A9%E4%BD%93/" />
<meta property="og:site_name" content="Unity XR 像 Alyx 一样抓取物体" />
<meta property="og:image"
  content="http://localhost:1313/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="0001-01-01 00:00:00 &#43;0000 UTC" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="http://localhost:1313/">
        <img class="octicon" height="32" width="32" src="">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:http://localhost:1313/">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="http://localhost:1313/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="http://localhost:1313/">
                  <img class=" avatar-user"
                    src="http://localhost:1313/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="http://localhost:1313/"></a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="http://localhost:1313/post/%E5%83%8Falyx%E4%B8%80%E6%A0%B7%E6%8A%93%E5%8F%96%E7%89%A9%E4%BD%93/">Unity XR 像 Alyx 一样抓取物体</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Mon, 01 Jan 0001 00:00:00 &#43;0000"
                    class="no-wrap">
                    Mon, 01 Jan 0001 00:00:00 &#43;0000</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      540 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/xr">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      XR
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/unity">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Unity
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="像-alyx-一样抓取物体">像 Alyx 一样抓取物体</h1>
<p>Source Video: <a href="https://www.youtube.com/watch?v=WU23Uj1oeh8">https://www.youtube.com/watch?v=WU23Uj1oeh8</a></p>
<p>基于 Unity XR Interaction Toolkit 2.6.3</p>
<h2 id="ray-interactor">Ray Interactor</h2>
<p>在 Interaction Layer Mask 设置好交互层级为 <code>Interactable</code> <code>Default</code></p>
<p><code>Anchor Control</code> 选项可选</p>
<p><img src="assets/image-20250209152354843.png" alt="RayInteractorInspector"></p>
<h2 id="grablale-object">Grablale Object</h2>
<p>可以抓取的物体需要有 <code>mesh collider</code> 组件</p>
<p>注意 <code>Interaction Layer Mask</code> 以及 <code>Movement Type</code> 的设置</p>
<p><img src="assets/image-20250209152726287.png" alt="GrablaleObjectInspector"></p>
<h2 id="xr-alyx-grab-interactable">XR Alyx Grab Interactable</h2>
<p>该脚本继承于 <code>XRGrabInteractable</code></p>
<p>功能简介：</p>
<ul>
<li>对准可抓取的物体时显示射线，物体会显示描边（可选显示一层覆盖颜色）</li>
<li>按住抓取按键时选中物体</li>
<li>选中物体后将手柄向上提起，物体会向手部位置飞去</li>
</ul>
<p>❗<strong>飞来的物体需要再次按抓取键才能抓在手上</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Collections;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Collections.Generic;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UnityEngine;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UnityEngine.XR.Interaction.Toolkit;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">XRAlyxGrabInteractable</span> : XRGrabInteractable
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [Tooltip(&#34;跳跃的速度阈值&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> velocityThreshold = <span style="color:#ae81ff">2f</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [Tooltip(&#34;跳跃时的角度&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> jumpAngleInDegree = <span style="color:#ae81ff">60f</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> XRRayInteractor rayInteractor;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Vector3 previousPos;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Rigidbody rb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">bool</span> canJump = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Awake()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.Awake();
</span></span><span style="display:flex;"><span>        rb = GetComponent&lt;Rigidbody&gt;();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> Update()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (isSelected &amp;&amp; canJump &amp;&amp; firstInteractorSelecting <span style="color:#66d9ef">is</span> XRRayInteractor)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 当物体被抓住时，计算速度是否超过阈值，超过则执行跳跃</span>
</span></span><span style="display:flex;"><span>            Vector3 velocity = (rayInteractor.transform.position - previousPos) / Time.deltaTime;
</span></span><span style="display:flex;"><span>            previousPos = rayInteractor.transform.position;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (velocity.magnitude &gt; velocityThreshold)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 脱离抓取</span>
</span></span><span style="display:flex;"><span>                Drop();
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 计算跳跃初速度</span>
</span></span><span style="display:flex;"><span>                rb.velocity = ComputeVelocity(transform.position, rayInteractor.transform.position, jumpAngleInDegree, Physics.gravity.y);
</span></span><span style="display:flex;"><span>                canJump = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// 基于重力计算弹道轨迹，计算从自身跳跃到指定地点的跳跃速度</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;selfPos&#34;&gt;&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;targetPos&#34;&gt;&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;jumpAngle&#34;&gt;&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;gravity&#34;&gt;&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Vector3 ComputeVelocity(Vector3 selfPos, Vector3 targetPos, <span style="color:#66d9ef">float</span> jumpAngle, <span style="color:#66d9ef">float</span> gravity)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Vector3 diff = targetPos - selfPos;
</span></span><span style="display:flex;"><span>        Vector3 diffXZ = <span style="color:#66d9ef">new</span>(diff.x, <span style="color:#ae81ff">0</span>, diff.z);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> diffXZLength = diffXZ.magnitude;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> diffYLength = diff.y;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> angleInRadian = Mathf.Clamp(diff.normalized.y * <span style="color:#ae81ff">90</span>, jumpAngle, <span style="color:#ae81ff">90</span>) * Mathf.Deg2Rad;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> jumpSpeed = Mathf.Sqrt(-gravity * Mathf.Pow(diffXZLength, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>            / (<span style="color:#ae81ff">2</span> * Mathf.Cos(angleInRadian) * Mathf.Cos(angleInRadian) * (diffXZ.magnitude * Mathf.Tan(angleInRadian) - diffYLength)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Vector3 jumpVelocityVector = jumpSpeed * Mathf.Cos(angleInRadian) * diffXZ.normalized + jumpSpeed * Mathf.Sin(angleInRadian) * Vector3.up;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> jumpVelocityVector;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> OnSelectEntered(SelectEnterEventArgs args)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 控制器检测 只响应射线交互器</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (args.interactableObject <span style="color:#66d9ef">is</span> XRRayInteractor)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            trackPosition = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>            trackRotation = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>            throwOnDetach = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            rayInteractor = (XRRayInteractor)args.interactorObject;
</span></span><span style="display:flex;"><span>            previousPos = rayInteractor.transform.position;
</span></span><span style="display:flex;"><span>            canJump = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            trackPosition = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            trackRotation = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            throwOnDetach = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.OnSelectEntered(args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='http://localhost:1313/js/toc.js'></script>
<link rel="stylesheet" href='http://localhost:1313/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="http://localhost:1313/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="http://localhost:1313/js/github-style.js"></script>







</html>